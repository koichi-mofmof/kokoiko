# ClippyMap TODO

## 🔴 緊急タスク

- [x] Next.js プロジェクトへの完全移行
  - [x] Vite 関連ファイルの削除
  - [x] Next.js 設定ファイルの作成
  - [x] srcd ディレクトリからのコンポーネント移行
    - [x] 型定義の移行 (types/)
    - [x] モックデータの移行 (lib/data/)
    - [x] Link コンポーネントの移行 (app/components/common/)
    - [x] ShareModal コンポーネントの移行 (app/components/share/)
    - [x] PlaceCard コンポーネントの移行 (app/components/places/)
    - [x] MapView コンポーネントの移行 (app/components/map/)
    - [x] FilterBar コンポーネントの移行 (app/components/places/)
    - [x] ViewToggle コンポーネントの移行 (app/components/places/)
    - [x] PlaceList コンポーネントの移行 (app/components/places/)
    - [x] SpotSearch コンポーネントの移行 (app/components/search/)
    - [x] AddPlaceForm コンポーネントの移行 (app/components/forms/)
    - [x] Header コンポーネントの移行 (app/components/ui/)
  - [x] 不要なファイルの整理

## 🟡 重要タスク

- [x] データベース設計
  - [x] スキーマ設計 (Place テーブルから notes カラム削除検討、user_comment に統一済み)
  - [x] Supabase のセットアップ
- [x] 認証機能の実装
  - [x] サインアップ機能実装
    - [x] Zod スキーマ作成 (signupSchema)
    - [x] Server Action 作成 (signupWithCredentials)
    - [x] サインアップフォームコンポーネント作成 (signup-form.tsx)
    - [x] パスワード表示切り替え機能実装
    - [x] パスワード要件変更（8 文字以上、大文字・小文字・数字・記号）とバリデーション修正
    - [x] サインアップページ作成 (signup/page.tsx)
  - [x] メール/パスワードログインフォーム作成
  - [x] Google ログインボタン追加
- [x] Supabase Auth の連携 (Server Actions)
  - [x] Zod によるバリデーションスキーマ作成 (lib/actions/auth.actions.ts)
  - [x] ログイン用 Server Action 作成 (loginWithCredentials, loginWithGoogle in lib/actions/auth.actions.ts)
  - [x] ログインフォームを Server Actions 対応にリファクタリング (useFormState, useFormStatus 使用)
- [x] Supabase クライアント設定の確認 (lib/supabase/client.ts, lib/supabase/server.ts)
- [x] ログインフォームコンポーネント作成 (app/components/auth/login-form.tsx)
- [x] ログインページ作成 (app/login/page.tsx)
- [x] 地図ライブラリの変更 (Mapbox -> OpenStreetMap) # 完了
  - [x] react-leaflet および関連ライブラリのインストール
  - [x] OpenStreetMapView コンポーネントの作成と基本機能実装
  - [x] MapboxView コンポーネントから OpenStreetMapView コンポーネントへの置き換え (SSR エラー対応含む)
  - [x] 動作確認と表示調整 (マーカー、ポップアップ、地図操作、フィルター表示)
  - [ ] 多言語対応の検討（可能な範囲で） # 残タスク
  - [x] パフォーマンス確認 (SSR エラー解消)
  - [x] 不要な Mapbox コンポーネント (MapboxView.tsx) の削除
  - [x] 不要な Mapbox ライブラリ (@mapbox/mapbox-gl-language) のアンインストール
- [~] リスト関連機能
  - [x] リスト登録機能追加
    - [x] リスト作成用 Server Action 作成
    - [x] リスト作成モーダル実装
    - [x] リスト一覧ページへの組み込み
  - [x] リスト詳細画面の UI コンポーネント共通化 (@sample と共通化)
    - [x] ParticipantAvatars を app/components/common/ に移動
    - [x] RankingView, RankingDisplay, RankingEditModal, RankingCard を app/components/lists/ に移動
    - [x] ListDetailView を app/components/lists/ に移動し、内部インポートを修正
    - [x] app/sample/[listId]/page.tsx のインポートパスを修正
    - [x] app/lists/[listId]/page.tsx のデータ取得処理を実装 (モックデータからの置き換え)
  - [x] リスト詳細ページの充実化 # ステータス変更
    - [x] リスト詳細データと共同編集者情報を Supabase から取得するよう修正
    - [x] 場所ごとのユーザーコメント表示
    - [x] Place 型の `notes` を `user_comment` に統一し、関連箇所を修正
  - [ ] 共有設定の実装
  - [ ] 非公開リストのアクセス制御実装
    - [ ] リスト詳細ページでの権限チェック
    - [ ] 非公開リストへの未認可アクセス時の処理（エラー表示またはリダイレクト）
    - [ ] `shared_lists`テーブルを使った権限確認ロジック
    - [ ] `list_share_tokens`を使った共有リンク経由のアクセス処理
- [x] 場所登録機能 # addPlace/add-place-todo.md と同期
  - [x] 登録フォーム (UI 設計、Autocomplete 連携など進行中)
  - [x] タグ付け機能 (UI 追加、Supabase 登録処理が次のタスク)
- [ ] 場所編集機能
  - [ ] 編集画面へのリンク追加 (PlaceCard, PlaceList)
  - [ ] 編集ページルート作成 (`/places/[id]/edit`)
  - [ ] 編集フォームコンポーネント作成 (基本)
  - [ ] Server Action での更新処理実装
  - [ ] フォームバリデーション (Zod)
  - [ ] フォームと Server Action の接続 (useFormState, useFormStatus)
- [~] 場所詳細画面の UI・機能
  - [x] 住所横に「MAP」ボタンを配置し、Google マップで開くように修正
  - [x] 既存の「Google マップで開く」リンクを削除
  - [x] コメント・タグ・訪問ステータスの表示
  - [x] 地図表示（PlaceMapClient）
  - [x] 編集・削除メニューの UI（DropdownMenu）
  - [x] コメントをスレッド形式で追加できるように（要テーブル定義変更）
  - [ ] 編集・削除機能の実装（Server Action 連携）
  - [ ] 権限判定・認可処理の強化
  - [ ] アクセシビリティ・レスポンシブ最適化
- [~] 行きたい場所リストのランキング機能実装 # 新規追加・進行中
  - [x] ランキングデータ構造の定義 (PlaceListGroup, RankedPlace)
  - [x] ランキング表示 UI コンポーネント作成 (RankingView, RankingDisplay, RankingCard)
  - [x] ランキング編集モーダル UI コンポーネント作成 (RankingEditModal)
  - [x] ランキング更新用 Server Action 作成 (updateRankingAction)
  - [ ] ランキング編集モーダルでのドラッグ＆ドロップによる順位変更機能
  - [ ] Supabase とのデータ連携 (ランキング情報の永続化)
  - [x] リスト詳細ページへのランキングビュータブ/切り替え UI の追加

## 🟢 通常タスク

- [ ] テスト関連 # 新規追加
  - [ ] テストカバレッジの向上 (目標 50%達成)
  - [x] `SearchableSampleList` コンポーネントのテストエラー修正
  - [x] `types/supabase.ts` のカバレッジ収集エラー修正
- [~] UI/UX の改善 # ステータスを進行中に変更
  - [x] MapPage / SampleMapPage のビュー切り替え機能実装 # 追加
  - [x] MapPage / SampleMapPage の FilterBar 実装とレイアウト調整 # 追加
  - [x] リスト詳細ページに共同編集者アバターを表示 (sharedUserIds 使用) # タスク名修正
  - [x] スマートフォン表示でマップピン選択時のカードの閉じるボタンが隠れる問題を修正
  - [x] スマートフォン表示でマップピン選択時の PlaceCard のサイズを調整
  - [x] RankingEditModal の UI デザイン調整 (テキストカラー、背景色、ボタン等)
  - [ ] モバイル対応 (継続的な改善) # 詳細化
  - [ ] ダークモード対応
  - [ ] ランキング表示 (RankingCard) のデザイン調整 (SNS 映えなど) # 新規追加
  - [ ] エラーメッセージのトースト通知化 (ランキング編集モーダルなど) # 新規追加
  - [x] リスト一覧画面の UI 改善（ボタン、検索/ソートバーの位置調整） # 新規追加
- [x] マイページ作成
  - [x] マイページ用ルート作成 (`app/lists/page.tsx`)
  - [x] サーバーコンポーネントでログインユーザーのリストを取得 (Supabase)
  - [x] リスト表示用クライアントコンポーネント作成 (`app/lists/_components/MyLists.tsx`)
  - [x] Sample 画面を参考に UI を構築 (検索機能、カードレイアウト)
  - [x] 型定義の整理 (`PlaceList` 型など)
  - [x] エラーハンドリングの改善 # ステータスを進行中に変更
    - [x] ユーザーフレンドリーなエラー UI（トースト通知など）の導入 (マイページ)
- [ ] グループ共有機能
  - [ ] グループ作成
  - [ ] 招待機能
- [~] フィルタリング機能 # ステータスを進行中に変更
  - [ ] 場所の検索 (SpotSearch 連携) # 詳細化
  - [x] タグによるフィルタリング # ステータスを完了に変更
  - [x] 訪問ステータスによるフィルタリング # 追加・完了
  - [x] リスト一覧画面に検索ボックスを追加し、リスト名で検索できるようにする # 新規追加・完了
  - [ ] リスト一覧での共有ユーザー表示
    - [ ] サーバーコンポーネントでリストごとの共有ユーザー情報を取得
    - [ ] 取得したデータをアバター UI に反映
  - [ ] リスト詳細ページでの実際の共同編集者データ連携 # 追加

## ⚪ 低優先タスク

- [ ] ソーシャル共有機能
- [ ] 通知機能
- [ ] エクスポート/インポート機能
- [x] サービス名変更: ココイコ -> ClippyMap
  - [x] 各ファイル内の「ココイコ」を「ClippyMap」に置換
  - [x] package.json の name を変更
- [ ] メール認証用 SMTP 設定
  - 本番運用や実際のメール送信確認のために、独自 SMTP サーバーの設定が必要
  - Supabase ダッシュボード > Authentication > Settings > Email Templates > SMTP Settings で設定
  - 公式ドキュメント: https://supabase.com/docs/guides/auth/auth-email#configuring-smtp
  - 見積時間: 30 分〜1 時間
- [x] ログイン後のヘッダー UI を shadcn/ui の Avatar・DropdownMenu で改善
  - ユーザー名＋アイコンをドロップダウン化
  - プロフィール・設定・ログアウトをメニューにまとめる
  - モバイルも同様の体験に
  - レスポンシブ・アクセシビリティ・UI 一貫性を担保
  - 依存: shadcn/ui/dropdown-menu 新規作成
  - 見積: 1h
